<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <title>{{ name }} - SVG 展示</title>
<link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css">
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/crt.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/cards.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/view_svg.css') }}">
</head>
<body class="min-h-screen font-mono">
<nav class="banner">
    <a href="{{ url_for('vps_list') }}" class="banner-home">
        <div class="banner-title">
            ⚡ <span>VPS</span> <span>剩余价值计算器</span>
        </div>
        <div class="banner-stats">
            在用主机：<strong>{{ site_stats.count }} 台</strong> / 总价值：<strong>{{ site_stats.total_value }} 元</strong>
        </div>
    </a>
    <div class="banner-subinfo">
        {% if current_user %}
        <span>你好, {{ current_user.username }}</span>
        <a class="text-sm border border-cyan-400 hover:bg-cyan-600 text-cyan-200 hover:text-white px-3 py-1 rounded transition" href="{{ url_for('add_vps') }}">添加 VPS</a>
        <a class="text-sm border border-cyan-400 hover:bg-cyan-600 text-cyan-200 hover:text-white px-3 py-1 rounded transition" href="{{ url_for('manage_vps') }}">管理 VPS</a>
        {% if current_user.is_admin %}
        <a class="text-sm border border-cyan-400 hover:bg-cyan-600 text-cyan-200 hover:text-white px-3 py-1 rounded transition" href="{{ url_for('manage_users') }}">用户管理</a>
        {% endif %}
        <a class="text-sm border border-cyan-400 hover:bg-cyan-600 text-cyan-200 hover:text-white px-3 py-1 rounded transition" href="{{ url_for('logout') }}">退出登录</a>
        {% else %}
        <a class="text-sm border border-cyan-400 hover:bg-cyan-600 text-cyan-200 hover:text-white px-3 py-1 rounded transition" href="{{ url_for('login') }}">登录</a>
        <a class="text-sm border border-cyan-400 hover:bg-cyan-600 text-cyan-200 hover:text-white px-3 py-1 rounded transition" href="{{ url_for('register') }}">注册</a>
        {% endif %}
    </div>
</nav>
<div class="card-container">
    <div class="svg-card">
        <h2 class="text-center text-cyan-300 text-xl mb-4 font-bold">{{ vps.name }}</h2>
        <dl class="vps-info-list">
            <dt>商家：</dt><dd>{{ vps.vendor_name or '-' }}</dd>
            <dt>配置：</dt><dd>{{ specs.cpu }} / {{ specs.memory }} / {{ specs.storage }}</dd>
            <dt>月流量：</dt><dd>{{ vps.traffic_limit or '-' }}</dd>
            <dt>IP 地址：</dt><dd>{{ ip_info.flag }} {{ ip_info.ip_display }} (<span class="ping-status" data-ip="{{ vps.ip_address }}">{{ ip_info.ping_status }}</span>)</dd>
            <dt>到期时间：</dt><dd>{{ data.cycle_end.strftime('%Y/%m/%d') if data.cycle_end else '-' }}</dd>
            <dt>续费金额：</dt><dd>{{ vps.renewal_price or '-' }} {{ vps.currency }}</dd>
            <dt>剩余天数：</dt><dd>{{ data.remaining_days }} 天</dd>
            <dt>剩余价值：</dt><dd>{{ data.remaining_value }} 元</dd>
            <dt>描述说明：</dt><dd>{{ vps.description or '-' }}</dd>
        </dl>
        <div class="vps-footer">
            <p>更新时间: {{ today.strftime('%Y/%m/%d') }}</p>
            <p>用户名: {{ config.username if config and config.username else '' }}</p>
        </div>
        <div class="card-buttons">
            <a href="{{ url_for('vps_list') }}">返回列表</a>
            <button id="copyLinkBtn">复制链接</button>
            <a href="{{ url_for('edit_vps', vps_id=vps_id) }}">编辑此项</a>
        </div>
    </div>
</div>
<script>
    function updatePingStatus() {
        document.querySelectorAll('.ping-status').forEach(el => {
            const ip = el.dataset.ip;
            fetch(`/ping/${ip}`).then(r => r.text()).then(t => {
                el.textContent = t;
            });
        });
    }
    updatePingStatus();
    setInterval(updatePingStatus, 60000);

    document.getElementById('copyLinkBtn').addEventListener('click', function () {
        const url = {{ svg_abs_url|tojson }};
        const text = `![image](${url})`;
        navigator.clipboard.writeText(text).then(() => {
            alert('链接已复制');
        }).catch(() => {
            alert('复制失败，请手动复制。');
        });
    });
</script>
<footer class="py-4 text-center text-xs text-gray-400">© {{ config.copyright }}</footer>
</body>
</html>
